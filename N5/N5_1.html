<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanji Flashcard</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light blue-gray background */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .flashcard-container {
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 900px; /* Wider to accommodate both sections */
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 2rem; /* Space between sections */
        }
        @media (min-width: 768px) { /* Medium screens and up */
            .flashcard-container {
                flex-direction: row; /* Side-by-side layout */
                justify-content: space-around;
                align-items: flex-start;
            }
        }

        .kanji-display-section, .options-section {
            flex: 1; /* Distribute space evenly */
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* New style for centering content in options-section when test finishes */
        .options-section.test-finished {
            display: flex; /* Make it a flex container */
            flex-direction: column; /* Stack children vertically */
            justify-content: center; /* Center children vertically */
            align-items: center; /* Center children horizontally */
            width: 100%; /* Ensure it spans the available width */
            height: 100%; /* Ensure it takes full available height in flex parent */
            flex: 1; /* Explicitly keep flex:1 from its parent */
        }

        .kanji-card {
            width: 400px;
            height: 400px;
            background-color: #e0e7ff; /* Lighter indigo - default state */
            border-radius: 1rem;
            display: flex;
            flex-direction: column; /* Allow multiple lines for info */
            justify-content: center;
            align-items: center;
            font-size: 9rem; /* Increased Kanji character size */
            font-weight: 700;
            color: #3730a3; /* Darker indigo - default state */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 1.5rem;
            cursor: default; /* Default cursor before answer */
            transition: background-color 0.2s ease, color 0.2s ease; /* Smooth transition for color */
            position: relative; /* Needed for absolute positioning of close button */
        }
        /* State when information is revealed */
        .kanji-card.reveal-state {
            cursor: pointer; /* Indicate it's clickable to advance */
            /* Adjust width for revealed state to accommodate more content */
            width: 400px; /* Take full width of its section */
            height: 400px; /* Adjust height based on content */
            min-height: 350px; /* Increased minimum height for the expanded card */
            padding: 1.5rem; /* Add padding for content */
            box-sizing: border-box; /* Include padding in width/height */
            align-items: flex-start; /* Align content to the left */
            text-align: left; /* Align text to the left */
            display: grid; /* Use grid for main kanji and info */
            grid-template-columns: auto 1fr; /* Kanji on left, info on right */
            gap: 1rem;
            flex-grow: 1; /* Ensure it grows to fill available space */
        }
        .kanji-card.reveal-state .main-kanji-char {
            font-size: 8rem; /* Adjusted for revealed state */
            grid-row: span 3; /* Span multiple rows in the grid */
            align-self: start; /* Align to the start of its grid cell */
            line-height: 1; /* Adjust line height */
        }
        .kanji-card.reveal-state .english-info {
            font-size: 1.8rem; /* Larger English font */
            font-weight: 600;
            margin-top: 0; /* Reset margin */
            grid-column: 2; /* Place in second column */
            align-self: start;
        }
        .kanji-card.reveal-state .kana-info-group {
            grid-column: 2; /* Place in second column */
            margin-top: 0.8rem; /* Space below English */
            align-self: start;
        }
        .kanji-card.reveal-state .onyomi-info,
        .kanji-card.reveal-state .kunyomi-info {
            font-size: 1.3rem; /* Adjusted kana font size */
            font-weight: 500;
            color: #4b5563; /* Darker gray for kana */
        }
        .kanji-card.reveal-state .example-words {
            grid-column: 1 / -1; /* Span all columns */
            margin-top: 1.8rem; /* Increased margin */
            text-align: left;
            width: 100%;
        }
        .kanji-card.reveal-state .example-words div {
            display: flex;
            justify-content: space-between;
            font-size: 1.1rem; /* Increased example words font size */
            color: #4b5563;
            margin-bottom: 0.4rem; /* Increased margin */
        }
        .kanji-card.reveal-state .example-words div span:first-child {
            font-weight: 600;
            color: #374151;
            margin-right: 1.2rem; /* Increased margin */
            white-space: nowrap; /* Prevent wrapping for Japanese part */
        }
        .kanji-card.reveal-state .next-card-message {
            grid-column: 1 / -1; /* Span all columns */
            margin-top: 2.5rem; /* Increased margin */
            font-size: 1.1rem; /* Increased font size */
            color: #6b7280;
            text-align: center;
            width: 100%;
        }

        /* Close button for revealed card */
        .close-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background-color: #ef4444; /* Red-500 */
            color: white;
            border-radius: 50%;
            width: 32px; /* Slightly larger button */
            height: 32px; /* Slightly larger button */
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1rem; /* Larger font for 'X' */
            font-weight: bold;
            cursor: pointer;
            z-index: 10; /* Ensure it's on top */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: background-color 0.2s ease;
        }
        .close-button:hover {
            background-color: #dc2626; /* Red-600 */
        }


        /* Specific state for correct answer flash */
        .kanji-card.correct-flash {
            background-color: #d1e7dd; /* Light green for correct */
            color: #155724; /* Darker green text for correct */
        }
        /* Specific state for incorrect answer flash */
        .kanji-card.incorrect-flash {
            background-color: #f8d7da; /* Light red for incorrect */
            color: #721c24; /* Darker red text for incorrect */
        }

        /* Default styles for kana/english info within kanji-card (used in reveal-state) */
        .kanji-card .kana-info, .kanji-card .english-info {
            font-size: 1.2rem; /* Default size for revealed info */
            font-weight: 500;
            color: inherit; /* Inherit color from parent (.kanji-card) */
            margin-top: 0.5rem;
        }
        /* NEW: Specific styles for Onyomi/Kunyomi when in initial 'kana' display mode */
        .kanji-card.initial-kana-view .onyomi-info,
        .kanji-card.initial-kana-view .kunyomi-info {
            font-size: 3rem; /* Increased Kana font size for initial display */
            font-weight: 700; /* Make it bold like the main Kanji */
            color: #3730a3; /* Match the main Kanji color */
        }
        .kanji-card.initial-kana-view .onyomi-info + .kanji-card.initial-kana-view .kunyomi-info {
            margin-top: 0.8rem; /* Slightly more space for larger text */
        }


        .radio-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            justify-content: center;
        }
        .radio-group label {
            cursor: pointer;
            font-weight: 500;
            color: #4b5563; /* Gray-700 */
        }
        .radio-group input[type="radio"] {
            accent-color: #4f46e5; /* Indigo */
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3 columns for options */
            gap: 1rem;
            width: 100%;
            max-width: 450px; /* Max width for options grid */
            height: 400px;
        }

        .option-button {
            background-color: #f3f4f6; /* Light gray */
            padding: 1rem;
            border-radius: 0.5rem;
            font-size: 1.1rem;
            font-weight: 500;
            color: #374151; /* Gray-800 */
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column; /* Allow multiple lines for kana */
            justify-content: center;
            align-items: center;
            min-height: 60px; /* Ensure consistent height */
            line-height: 1.3; /* Adjust line height for multi-line text */
        }
        .option-button .onyomi-option-info,
        .option-button .kunyomi-option-info {
            font-size: 1.2rem; /* Slightly smaller font for options */
            font-weight: 500;
            color: #374151;
        }

        .option-button .kanji-option-info {
            font-size: 3rem; /* Match the main option-button font size */
            font-weight: 500;
            color: #374151;
        }

        /* New styles for English and Kanji option text */
        .option-button .english-option-info {
            font-size: 1.1rem; /* Match the main option-button font size */
            font-weight: 500;
            color: #374151;
        }

        .option-button .onyomi-option-info + .kunyomi-option-info {
            margin-top: 0.1rem; /* Smaller space between Onyomi and Kunyomi in options */
        }

        .option-button:hover {
            background-color: #e5e7eb; /* Darker light gray */
            transform: translateY(-2px);
        }
        .option-button:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        .option-button.disabled-option {
            pointer-events: none; /* Disable clicks */
            opacity: 0.6; /* Dim disabled buttons */
            cursor: not-allowed;
        }
        .option-button.correct-answer {
            background-color: #d1e7dd; /* Green for correct */
            border: 2px solid #28a745;
        }
        .option-button.incorrect-answer {
            background-color: #f8d7da; /* Red for incorrect */
            border: 2px solid #dc3545;
        }


        /* Header styling */
        .header {
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            margin-bottom: 1.5rem;
            color: #4b5563;
            font-size: 0.9rem;
        }
        .header-left, .header-right {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        .social-icons a {
            color: #4b5563;
            font-size: 1.2rem;
            text-decoration: none;
            transition: color 0.2s ease;
        }
        .social-icons a:hover {
            color: #4f46e5;
        }
        .score-info {
            font-weight: 600;
        }
        .download-app-section {
            background-color: #ffffff;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-top: 2rem;
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }
        @media (min-width: 640px) {
            .download-app-section {
                flex-direction: row;
                justify-content: center;
            }
        }
        .app-icon {
            font-size: 3rem;
            color: #4f46e5;
        }
        .app-text {
            font-size: 1.1rem;
            color: #374151;
            text-align: center;
        }
        .app-stores {
            display: flex;
            gap: 1rem;
        }
        .app-stores img {
            height: 40px;
            border-radius: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <span>JLPT N5 </span>
            <select class="rounded-md border border-gray-300 px-2 py-1 text-sm">
                <option>Select level</option>
                <option>N5</option>
                <option>N4</option>
                <option>N3</option>
                <option>N2</option>
                <option>N1</option>
            </select>
            <!-- New dropdown for session size -->
            <label for="sessionSizeSelect" class="text-sm">Session Size:</label>
            <select id="sessionSizeSelect" class="rounded-md border border-gray-300 px-2 py-1 text-sm">
                 <option value="10">10</option>
                <option value="20">20</option>
                <option value="50">50</option>
                <option value="all">All (97)</option>
            </select>
        </div>
        <div class="header-right">
            <div class="social-icons">
                <!-- Placeholder for social media icons -->
                <a href="#" class="mr-2"><i class="fab fa-facebook-f"></i></a>
                <a href="#" class="mr-2"><i class="fab fa-google-plus-g"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
            </div>
            <div class="score-info">
                <span>Correct: <span id="correctCount">0</span></span> |
                <span>Incorrect: <span id="incorrectCount">0</span></span> |
                <span>Remaining: <span id="remainingCount">0</span></span> |
                <span><span id="percentage">0</span>%</span>
            </div>
        </div>
    </div>

    <div class="flashcard-container">
        <div class="kanji-display-section">
            <div class="kanji-card" id="kanjiCard">
                <!-- Kanji will be loaded here -->
            </div>
            <!-- Display type radio group -->
            <div class="radio-group" id="displayTypeRadioGroup">
                <input type="radio" id="kanjiDisplay" name="displayType" value="kanji" checked>
                <label for="kanjiDisplay">Kanji</label>
                <input type="radio" id="kanaDisplay" name="displayType" value="kana">
                <label for="kanaDisplay">Kana</label>
                <input type="radio" id="englishDisplay" name="displayType" value="english">
                <label for="englishDisplay">English</label>
            </div>
        </div>

        <div class="options-section" id="optionsSection">
            <div class="options-grid" id="optionsGrid">
                <!-- Options will be loaded here -->
            </div>
            <!-- Answer type radio group -->
            <div class="radio-group mt-4" id="answerTypeRadioGroup">
                <!-- Reordered to put Kanji first -->
                <div id="kanjiAnswerOption" style="display: none;">
                    <input type="radio" id="kanjiAnswer" name="answerType" value="kanji">
                    <label for="kanjiAnswer">Kanji</label>
                </div>
                <div id="kanaAnswerOption">
                    <input type="radio" id="kanaAnswer" name="answerType" value="kana" checked>
                    <label for="kanaAnswer">Kana</label>
                </div>
                <div id="englishAnswerOption">
                    <input type="radio" id="englishAnswer" name="answerType" value="english">
                    <label for="englishAnswer">English</label>
                </div>
            </div>
        </div>
    </div>

    <div class="download-app-section">
        <span class="app-icon">ðŸ“š</span>
        <div class="app-text">
            <p class="font-semibold">Get the mobile app!</p>
            <p>Practice Kanji on the go!</p>
        </div>
        <div class="app-stores">
            <img src="https://placehold.co/120x40/000000/FFFFFF?text=App+Store" alt="App Store">
            <img src="https://placehold.co/120x40/000000/FFFFFF?text=Google+Play" alt="Google Play">
        </div>
    </div>

    <!-- Font Awesome for social icons (example) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js"></script>
    <script>
        // --- In-memory Kanji Data for N5  ---
        const kanjiN5Part1Full = [
            { "kanji": "ä¸€", "kana": "ã‚¤ãƒ | ã²ã¨(ã¤)", "english": "one", "examples": [
                { "japanese": "ä¸€äºº (ã²ã¨ã‚Š)", "english": "one person" },
                { "japanese": "ä¸€æ—¥ (ã„ã¡ã«ã¡)", "english": "one day" }
            ]},
            { "kanji": "äºŒ", "kana": "ãƒ‹ | ãµãŸ(ã¤)", "english": "two", "examples": [
                { "japanese": "äºŒäºº (ãµãŸã‚Š)", "english": "two people" },
                { "japanese": "äºŒæ—¥ (ãµã¤ã‹)", "english": "two days" }
            ]},
            { "kanji": "ä¸‰", "kana": "ã‚µãƒ³ | ã¿ã£(ã¤)", "english": "three", "examples": [
                { "japanese": "ä¸‰äºº (ã•ã‚“ã«ã‚“)", "english": "three people" },
                { "japanese": "ä¸‰æ—¥ (ã¿ã£ã‹)", "english": "three days" }
            ]},
            { "kanji": "å››", "kana": "ã‚· | ã‚ˆã‚“(ã¤)", "english": "four", "examples": [
                { "japanese": "å››äºº (ã‚ˆã«ã‚“)", "english": "four people" },
                { "japanese": "å››æ—¥ (ã‚ˆã£ã‹)", "english": "four days" }
            ]},
            { "kanji": "äº”", "kana": "ã‚´ | ã„ã¤(ã¤)", "english": "five", "examples": [
                { "japanese": "äº”äºº (ã”ã«ã‚“)", "english": "five people" },
                { "japanese": "äº”æ—¥ (ã„ã¤ã‹)", "english": "five days" }
            ]},
            { "kanji": "å…­", "kana": "ãƒ­ã‚¯ | ã‚€ã£(ã¤)", "english": "six", "examples": [
                { "japanese": "å…­äºº (ã‚ãã«ã‚“)", "english": "six people" },
                { "japanese": "å…­æ—¥ (ã‚€ã„ã‹)", "english": "six days" }
            ]},
            { "kanji": "ä¸ƒ", "kana": "ã‚·ãƒ | ãªãª(ã¤)", "english": "seven", "examples": [
                { "japanese": "ä¸ƒäºº (ãªãªã«ã‚“)", "english": "seven people" },
                { "japanese": "ä¸ƒæ—¥ (ãªã®ã‹)", "english": "seven days" }
            ]},
            { "kanji": "å…«", "kana": "ãƒãƒ | ã‚„ã£(ã¤)", "english": "eight", "examples": [
                { "japanese": "å…«äºº (ã¯ã¡ã«ã‚“)", "english": "eight people" },
                { "japanese": "å…«æ—¥ (ã‚ˆã†ã‹)", "english": "eight days" }
            ]},
            { "kanji": "ä¹", "kana": "ã‚­ãƒ¥ã‚¦ | ã“ã“ã®(ã¤)", "english": "nine", "examples": [
                { "japanese": "ä¹äºº (ãã‚…ã†ã«ã‚“)", "english": "nine people" },
                { "japanese": "ä¹æ—¥ (ã“ã“ã®ã‹)", "english": "nine days" }
            ]},
            { "kanji": "å", "kana": "ã‚¸ãƒ¥ã‚¦ | ã¨ãŠ", "english": "ten", "examples": [
                { "japanese": "åäºº (ã˜ã‚…ã†ã«ã‚“)", "english": "ten people" },
                { "japanese": "åæ—¥ (ã¨ãŠã‹)", "english": "ten days" }
            ]},
            { "kanji": "æ—¥", "kana": "ãƒ‹ãƒ | ã²", "english": "day, sun", "examples": [
                { "japanese": "æ—¥æœ¬ (ã«ã»ã‚“)", "english": "Japan" },
                { "japanese": "æ¯Žæ—¥ (ã¾ã„ã«ã¡)", "english": "every day" }
            ]},
            { "kanji": "å›½", "kana": "ã‚³ã‚¯ | ãã«", "english": "country", "examples": [
                { "japanese": "å¤–å›½ (ãŒã„ã“ã)", "english": "foreign country" },
                { "japanese": "ä¸­å›½ (ã¡ã‚…ã†ã”ã)", "english": "China" }
            ]},
            { "kanji": "äºº", "kana": "ã‚¸ãƒ³ | ã²ã¨", "english": "person", "examples": [
                { "japanese": "æ—¥æœ¬äºº (ã«ã»ã‚“ã˜ã‚“)", "english": "Japanese person" },
                { "japanese": "å¤§äºº (ãŠã¨ãª)", "english": "adult" }
            ]},
            { "kanji": "å¹´", "kana": "ãƒãƒ³ | ã¨ã—", "english": "year", "examples": [
                { "japanese": "æ¥å¹´ (ã‚‰ã„ã­ã‚“)", "english": "next year" },
                { "japanese": "ä»Šå¹´ (ã“ã¨ã—)", "english": "this year" }
            ]},
            { "kanji": "å¤§", "kana": "ãƒ€ã‚¤ | ãŠãŠ(ãã„)", "english": "large, big", "examples": [
                { "japanese": "å¤§å­¦ (ã ã„ãŒã)", "english": "university" },
                { "japanese": "å¤§ãã„ (ãŠãŠãã„)", "english": "big" }
            ]},
            { "kanji": "æœ¬", "kana": "ãƒ›ãƒ³ | ã‚‚ã¨", "english": "book, origin", "examples": [
                { "japanese": "æ—¥æœ¬èªž (ã«ã»ã‚“ã”)", "english": "Japanese language" },
                { "japanese": "æœ¬å±‹ (ã»ã‚“ã‚„)", "english": "bookstore" }
            ]},
            { "kanji": "ä¸­", "kana": "ãƒãƒ¥ã‚¦ | ãªã‹", "english": "in, inside, middle, center", "examples": [
                { "japanese": "ä¸­å›½ (ã¡ã‚…ã†ã”ã)", "english": "China" },
                { "japanese": "ä¸­å­¦ç”Ÿ (ã¡ã‚…ã†ãŒãã›ã„)", "english": "junior high school student" }
            ]},
            { "kanji": "é•·", "kana": "ãƒãƒ§ã‚¦ | ãªãŒ(ã„)", "english": "long, leader", "examples": [
                { "japanese": "ç¤¾é•· (ã—ã‚ƒã¡ã‚‡ã†)", "english": "company president" },
                { "japanese": "é•·ã„ (ãªãŒã„)", "english": "long" }
            ]},
            { "kanji": "å‡º", "kana": "ã‚·ãƒ¥ãƒ„ | ã§(ã‚‹)", "english": "exit, leave, go out", "examples": [
                { "japanese": "å‡ºå£ (ã§ãã¡)", "english": "exit" },
                { "japanese": "å‡ºã™ (ã ã™)", "english": "to take out" }
            ]},
            { "kanji": "ä¸Š", "kana": "ã‚¸ãƒ§ã‚¦ | ã†ãˆ", "english": "above, up", "examples": [
                { "japanese": "ä¸Šæ‰‹ (ã˜ã‚‡ã†ãš)", "english": "skillful" },
                { "japanese": "ä¸ŠãŒã‚‹ (ã‚ãŒã‚‹)", "english": "to go up" }
            ]},
            { "kanji": "ä¸‹", "kana": "ã‚« | ã—ãŸ", "english": "below, down", "examples": [
                { "japanese": "ä¸‹æ‰‹ (ã¸ãŸ)", "english": "unskillful" },
                { "japanese": "ä¸‹ãŒã‚‹ (ã•ãŒã‚‹)", "english": "to go down" }
            ]},
            { "kanji": "å‰", "kana": "ã‚¼ãƒ³ | ã¾ãˆ", "english": "before, front", "examples": [
                { "japanese": "åå‰ (ãªã¾ãˆ)", "english": "name" },
                { "japanese": "åˆå‰ (ã”ãœã‚“)", "english": "A.M." }
            ]},
            { "kanji": "å¾Œ", "kana": "ã‚´ | ã‚ã¨", "english": "after, behind", "examples": [
                { "japanese": "åˆå¾Œ (ã”ã”)", "english": "P.M." },
                { "japanese": "å¾Œã§ (ã‚ã¨ã§)", "english": "later" }
            ]},
            { "kanji": "ä»Š", "kana": "ã‚³ãƒ³ | ã„ã¾", "english": "now", "examples": [
                { "japanese": "ä»Šæ—¥ (ãã‚‡ã†)", "english": "today" },
                { "japanese": "ä»Šé€± (ã“ã‚“ã—ã‚…ã†)", "english": "this week" }
            ]},
            { "kanji": "åˆ†", "kana": "ãƒ•ãƒ³ | ã‚(ã‘ã‚‹)", "english": "minute, part, understand", "examples": [
                { "japanese": "äº”åˆ† (ã”ãµã‚“)", "english": "five minutes" },
                { "japanese": "åˆ†ã‹ã‚‹ (ã‚ã‹ã‚‹)", "english": "to understand" }
            ]},
            { "kanji": "å°", "kana": "ã‚·ãƒ§ã‚¦ | ã¡ã„(ã•ã„)", "english": "small", "examples": [
                { "japanese": "å°ã•ã„ (ã¡ã„ã•ã„)", "english": "small" },
                { "japanese": "å°å­¦æ ¡ (ã—ã‚‡ã†ãŒã£ã“ã†)", "english": "elementary school" }
            ]},
            { "kanji": "é«˜", "kana": "ã‚³ã‚¦ | ãŸã‹(ã„)", "english": "high, expensive", "examples": [
                { "japanese": "é«˜æ ¡ (ã“ã†ã“ã†)", "english": "high school" },
                { "japanese": "é«˜ã„ (ãŸã‹ã„)", "english": "tall, expensive" }
            ]},
            { "kanji": "å­¦", "kana": "ã‚¬ã‚¯ | ã¾ãª(ã¶)", "english": "study, learn", "examples": [
                { "japanese": "å­¦ç”Ÿ (ãŒãã›ã„)", "english": "student" },
                { "japanese": "å­¦æ ¡ (ãŒã£ã“ã†)", "english": "school" }
            ]},
            { "kanji": "ç”Ÿ", "kana": "ã‚»ã‚¤ | ã„(ãã‚‹)", "english": "life, birth", "examples": [
                { "japanese": "å…ˆç”Ÿ (ã›ã‚“ã›ã„)", "english": "teacher" },
                { "japanese": "ç”Ÿã¾ã‚Œã‚‹ (ã†ã¾ã‚Œã‚‹)", "english": "to be born" }
            ]},
            { "kanji": "è¦‹", "kana": "ã‚±ãƒ³ | ã¿(ã‚‹)", "english": "see, look", "examples": [
                { "japanese": "è¦‹ã‚‹ (ã¿ã‚‹)", "english": "to see" },
                { "japanese": "è¦‹ã›ã‚‹ (ã¿ã›ã‚‹)", "english": "to show" }
            ]},
            { "kanji": "å¤–", "kana": "ã‚¬ã‚¤ | ãã¨", "english": "outside, other", "examples": [
                { "japanese": "å¤–å›½ (ãŒã„ã“ã)", "english": "foreign country" },
                { "japanese": "å¤–å›½äºº (ãŒã„ã“ãã˜ã‚“)", "english": "foreigner" }
            ]},
            { "kanji": "èªž", "kana": "ã‚´ | ã‹ãŸ(ã‚‹)", "english": "language, word", "examples": [
                { "japanese": "æ—¥æœ¬èªž (ã«ã»ã‚“ã”)", "english": "Japanese language" },
                { "japanese": "è‹±èªž (ãˆã„ã”)", "english": "English language" }
            ]},
            { "kanji": "èž", "kana": "ãƒ–ãƒ³ | ã(ã)", "english": "hear, listen", "examples": [
                { "japanese": "èžã (ãã)", "english": "to listen, to ask" },
                { "japanese": "æ–°èž (ã—ã‚“ã¶ã‚“)", "english": "newspaper" }
            ]},
            { "kanji": "é£Ÿ", "kana": "ã‚·ãƒ§ã‚¯ | ãŸ(ã¹ã‚‹)", "english": "eat, food", "examples": [
                { "japanese": "é£Ÿã¹ã‚‹ (ãŸã¹ã‚‹)", "english": "to eat" },
                { "japanese": "é£Ÿã¹ç‰© (ãŸã¹ã‚‚ã®)", "english": "food" }
            ]},
            { "kanji": "æ›¸", "kana": "ã‚·ãƒ§ | ã‹(ã)", "english": "write", "examples": [
                { "japanese": "æ›¸ã (ã‹ã)", "english": "to write" },
                { "japanese": "æ•™ç§‘æ›¸ (ãã‚‡ã†ã‹ã—ã‚‡)", "english": "textbook" }
            ]},
            { "kanji": "èª­", "kana": "ãƒ‰ã‚¯ | ã‚ˆ(ã‚€)", "english": "read", "examples": [
                { "japanese": "èª­ã‚€ (ã‚ˆã‚€)", "english": "to read" },
                { "japanese": "èª­æ›¸ (ã©ãã—ã‚‡)", "english": "reading books" }
            ]},
            { "kanji": "è©±", "kana": "ãƒ¯ | ã¯ãª(ã™)", "english": "talk, story", "examples": [
                { "japanese": "è©±ã™ (ã¯ãªã™)", "english": "to speak" },
                { "japanese": "é›»è©± (ã§ã‚“ã‚)", "english": "telephone" }
            ]},
            { "kanji": "é‡‘", "kana": "ã‚­ãƒ³ | ã‹ã­", "english": "gold, money", "examples": [
                { "japanese": "ãŠé‡‘ (ãŠã‹ã­)", "english": "money" },
                { "japanese": "ç¾é‡‘ (ã’ã‚“ãã‚“)", "english": "cash" }
            ]},
            { "kanji": "åœŸ", "kana": "ãƒ‰ | ã¤ã¡", "english": "earth, soil", "examples": [
                { "japanese": "åœŸåœ° (ã¨ã¡)", "english": "land" },
                { "japanese": "åœŸæ›œæ—¥ (ã©ã‚ˆã†ã³)", "english": "Saturday" }
            ]},
            { "kanji": "æ¥", "kana": "ãƒ©ã‚¤ | ã(ã‚‹)", "english": "come, next", "examples": [
                { "japanese": "æ¥ã‚‹ (ãã‚‹)", "english": "to come" },
                { "japanese": "æ¥é€± (ã‚‰ã„ã—ã‚…ã†)", "english": "next week" }
            ]},
            { "kanji": "å…¥", "kana": "ãƒ‹ãƒ¥ã‚¦ | ã¯ã„(ã‚‹)", "english": "enter, insert", "examples": [
                { "japanese": "å…¥ã‚‹ (ã¯ã„ã‚‹)", "english": "to enter" },
                { "japanese": "å…¥å£ (ã„ã‚Šãã¡)", "english": "entrance" }
            ]},
            { "kanji": "å††", "kana": "ã‚¨ãƒ³ | ã¾ã‚‹(ã„)", "english": "yen, circle", "examples": [
                { "japanese": "ç™¾å†† (ã²ã‚ƒããˆã‚“)", "english": "100 yen" },
                { "japanese": "å††ã„ (ã¾ã‚‹ã„)", "english": "round" }
            ]},
            { "kanji": "å±±", "kana": "ã‚µãƒ³ | ã‚„ã¾", "english": "mountain", "examples": [
                { "japanese": "å¯Œå£«å±± (ãµã˜ã•ã‚“)", "english": "Mt. Fuji" },
                { "japanese": "å±±é“ (ã‚„ã¾ã¿ã¡)", "english": "mountain path" }
            ]},
            { "kanji": "å·", "kana": "ã‚»ãƒ³ | ã‹ã‚", "english": "river", "examples": [
                { "japanese": "å·å²¸ (ã‹ã‚ãŽã—)", "english": "river bank" },
                { "japanese": "å°å· (ãŠãŒã‚)", "english": "stream" }
            ]},
            { "kanji": "åƒ", "kana": "ã‚»ãƒ³ | ã¡", "english": "thousand", "examples": [
                { "japanese": "ä¸‰åƒ (ã•ã‚“ãœã‚“)", "english": "three thousand" },
                { "japanese": "åƒè‘‰ (ã¡ã°)", "english": "Chiba (place name)" }
            ]},
            { "kanji": "ä¸‡", "kana": "ãƒžãƒ³", "english": "ten thousand", "examples": [
                { "japanese": "ä¸€ä¸‡å†† (ã„ã¡ã¾ã‚“ãˆã‚“)", "english": "ten thousand yen" },
                { "japanese": "ä¸‡å¹´ç­† (ã¾ã‚“ã­ã‚“ã²ã¤)", "english": "fountain pen" }
            ]},
            { "kanji": "å", "kana": "ãƒ¡ã‚¤ | ãª", "english": "name", "examples": [
                { "japanese": "åå‰ (ãªã¾ãˆ)", "english": "name" },
                { "japanese": "æœ‰å (ã‚†ã†ã‚ã„)", "english": "famous" }
            ]},
            { "kanji": "å¥³", "kana": "ã‚¸ãƒ§ | ãŠã‚“ãª", "english": "woman, female", "examples": [
                { "japanese": "å¥³ã®å­ (ãŠã‚“ãªã®ã“)", "english": "girl" },
                { "japanese": "å¥³æ€§ (ã˜ã‚‡ã›ã„)", "english": "woman" }
            ]},
            { "kanji": "ç”·", "kana": "ãƒ€ãƒ³ | ãŠã¨ã“", "english": "man, male", "examples": [
                { "japanese": "ç”·ã®å­ (ãŠã¨ã“ã®ã“)", "english": "boy" },
                { "japanese": "ç”·æ€§ (ã ã‚“ã›ã„)", "english": "man" }
            ]},
            { "kanji": "å­", "kana": "ã‚· | ã“", "english": "child", "examples": [
                { "japanese": "å­ä¾› (ã“ã©ã‚‚)", "english": "child, children" },
                { "japanese": "å¥³å­ (ã˜ã‚‡ã—)", "english": "girl, female student" }
            ]},
            { "kanji": "å…ˆ", "kana": "ã‚»ãƒ³ | ã•ã", "english": "before, ahead, previous", "examples": [
                { "japanese": "å…ˆç”Ÿ (ã›ã‚“ã›ã„)", "english": "teacher" },
                { "japanese": "å…ˆé€± (ã›ã‚“ã—ã‚…ã†)", "english": "last week" }
            ]},
            { "kanji": "ç§", "kana": "ã‚· | ã‚ãŸã—", "english": "I, private", "examples": [
                { "japanese": "ç§ (ã‚ãŸã—)", "english": "I" },
                { "japanese": "ç§ç«‹ (ã—ã‚Šã¤)", "english": "private (institution)" }
            ]},
            { "kanji": "å‹", "kana": "ãƒ¦ã‚¦ | ã¨ã‚‚", "english": "friend", "examples": [
                { "japanese": "å‹é” (ã¨ã‚‚ã ã¡)", "english": "friend" },
                { "japanese": "è¦ªå‹ (ã—ã‚“ã‚†ã†)", "english": "best friend" }
            ]},
            { "kanji": "çˆ¶", "kana": "ãƒ• | ã¡ã¡", "english": "father", "examples": [
                { "japanese": "ãŠçˆ¶ã•ã‚“ (ãŠã¨ã†ã•ã‚“)", "english": "father (polite)" },
                { "japanese": "çˆ¶è¦ª (ã¡ã¡ãŠã‚„)", "english": "father" }
            ]},
            { "kanji": "æ¯", "kana": "ãƒœ | ã¯ã¯", "english": "mother", "examples": [
                { "japanese": "ãŠæ¯ã•ã‚“ (ãŠã‹ã‚ã•ã‚“)", "english": "mother (polite)" },
                { "japanese": "æ¯è¦ª (ã¯ã¯ãŠã‚„)", "english": "mother" }
            ]},
            { "kanji": "å³", "kana": "ã‚¦ | ã¿ãŽ", "english": "right", "examples": [
                { "japanese": "å³ (ã¿ãŽ)", "english": "right" },
                { "japanese": "å³æ‰‹ (ã¿ãŽã¦)", "english": "right hand" }
            ]},
            { "kanji": "å·¦", "kana": "ã‚µ | ã²ã ã‚Š", "english": "left", "examples": [
                { "japanese": "å·¦ (ã²ã ã‚Š)", "english": "left" },
                { "japanese": "å·¦æ‰‹ (ã²ã ã‚Šã¦)", "english": "left hand" }
            ]},
            { "kanji": "æ±", "kana": "ãƒˆã‚¦ | ã²ãŒã—", "english": "east", "examples": [
                { "japanese": "æ±äº¬ (ã¨ã†ãã‚‡ã†)", "english": "Tokyo" },
                { "japanese": "æ±å£ (ã²ãŒã—ãã¡)", "english": "east exit" }
            ]},
            { "kanji": "è¥¿", "kana": "ã‚»ã‚¤ | ã«ã—", "english": "west", "examples": [
                { "japanese": "è¥¿å£ (ã«ã—ãã¡)", "english": "west exit" },
                { "japanese": "é–¢è¥¿ (ã‹ã‚“ã•ã„)", "english": "Kansai region" }
            ]},
            { "kanji": "å—", "kana": "ãƒŠãƒ³ | ã¿ãªã¿", "english": "south", "examples": [
                { "japanese": "å—å£ (ã¿ãªã¿ãã¡)", "english": "south exit" },
                { "japanese": "æ±å—ã‚¢ã‚¸ã‚¢ (ã¨ã†ãªã‚“ã‚¢ã‚¸ã‚¢)", "english": "Southeast Asia" }
            ]},
            { "kanji": "åŒ—", "kana": "ãƒ›ã‚¯ | ããŸ", "english": "north", "examples": [
                { "japanese": "åŒ—å£ (ããŸãã¡)", "english": "north exit" },
                { "japanese": "åŒ—æµ·é“ (ã»ã£ã‹ã„ã©ã†)", "english": "Hokkaido" }
            ]},
            { "kanji": "äº¬", "kana": "ã‚­ãƒ§ã‚¦", "english": "capital", "examples": [
                { "japanese": "æ±äº¬ (ã¨ã†ãã‚‡ã†)", "english": "Tokyo" },
                { "japanese": "äº¬éƒ½ (ãã‚‡ã†ã¨)", "english": "Kyoto" }
            ]},
            { "kanji": "åº—", "kana": "ãƒ†ãƒ³ | ã¿ã›", "english": "shop, store", "examples": [
                { "japanese": "åº— (ã¿ã›)", "english": "shop" },
                { "japanese": "å–«èŒ¶åº— (ãã£ã•ã¦ã‚“)", "english": "coffee shop" }
            ]},
            { "kanji": "é§…", "kana": "ã‚¨ã‚­", "english": "station", "examples": [
                { "japanese": "é§… (ãˆã)", "english": "station" },
                { "japanese": "é§…å“¡ (ãˆãã„ã‚“)", "english": "station attendant" }
            ]},
            { "kanji": "è»Š", "kana": "ã‚·ãƒ£ | ãã‚‹ã¾", "english": "car, vehicle", "examples": [
                { "japanese": "é›»è»Š (ã§ã‚“ã—ã‚ƒ)", "english": "train" },
                { "japanese": "è‡ªå‹•è»Š (ã˜ã©ã†ã—ã‚ƒ)", "english": "automobile" }
            ]},
            { "kanji": "é›»", "kana": "ãƒ‡ãƒ³", "english": "electricity", "examples": [
                { "japanese": "é›»æ°— (ã§ã‚“ã)", "english": "electricity, light" },
                { "japanese": "é›»è©± (ã§ã‚“ã‚)", "english": "telephone" }
            ]},
            { "kanji": "å¤©", "kana": "ãƒ†ãƒ³", "english": "heaven, sky", "examples": [
                { "japanese": "å¤©æ°— (ã¦ã‚“ã)", "english": "weather" },
                { "japanese": "å¤©å›½ (ã¦ã‚“ã”ã)", "english": "heaven" }
            ]},
            { "kanji": "æ°—", "kana": "ã‚­", "english": "spirit, air, mood", "examples": [
                { "japanese": "å¤©æ°— (ã¦ã‚“ã)", "english": "weather" },
                { "japanese": "å…ƒæ°— (ã’ã‚“ã)", "english": "healthy, energetic" }
            ]},
            { "kanji": "é›¨", "kana": "ã‚¦ | ã‚ã‚", "english": "rain", "examples": [
                { "japanese": "é›¨ (ã‚ã‚)", "english": "rain" },
                { "japanese": "å¤§é›¨ (ãŠãŠã‚ã‚)", "english": "heavy rain" }
            ]},
            { "kanji": "ç«‹", "kana": "ãƒªãƒ„ | ãŸ(ã¤)", "english": "stand, establish", "examples": [
                { "japanese": "ç«‹ã¤ (ãŸã¤)", "english": "to stand" },
                { "japanese": "å›½ç«‹ (ã“ãã‚Šã¤)", "english": "national (institution)" }
            ]},
            { "kanji": "ä¼‘", "kana": "ã‚­ãƒ¥ã‚¦ | ã‚„ã™(ã‚€)", "english": "rest, holiday", "examples": [
                { "japanese": "ä¼‘ã‚€ (ã‚„ã™ã‚€)", "english": "to rest" },
                { "japanese": "ä¼‘æ—¥ (ãã‚…ã†ã˜ã¤)", "english": "holiday" }
            ]},
            { "kanji": "ä¼š", "kana": "ã‚«ã‚¤ | ã‚(ã†)", "english": "meet, association", "examples": [
                { "japanese": "ä¼šã† (ã‚ã†)", "english": "to meet" },
                { "japanese": "ä¼šç¤¾ (ã‹ã„ã—ã‚ƒ)", "english": "company" }
            ]},
            { "kanji": "åŒ", "kana": "ãƒ‰ã‚¦ | ãŠãª(ã˜)", "english": "same, agree", "examples": [
                { "japanese": "åŒã˜ (ãŠãªã˜)", "english": "same" },
                { "japanese": "åŒæ™‚ (ã©ã†ã˜)", "english": "same time" }
            ]},
            { "kanji": "æ€", "kana": "ã‚· | ãŠã‚‚(ã†)", "english": "think, feel", "examples": [
                { "japanese": "æ€ã† (ãŠã‚‚ã†)", "english": "to think" },
                { "japanese": "æ€ã„å‡º (ãŠã‚‚ã„ã§)", "english": "memory" }
            ]},
            { "kanji": "å®¶", "kana": "ã‚« | ã„ãˆ", "english": "house, home", "examples": [
                { "japanese": "å®¶ (ã„ãˆ)", "english": "house" },
                { "japanese": "å®¶æ— (ã‹ãžã)", "english": "family" }
            ]},
            { "kanji": "å®‰", "kana": "ã‚¢ãƒ³ | ã‚„ã™(ã„)", "english": "cheap, peaceful", "examples": [
                { "japanese": "å®‰ã„ (ã‚„ã™ã„)", "english": "cheap" },
                { "japanese": "å®‰å¿ƒ (ã‚ã‚“ã—ã‚“)", "english": "relief" }
            ]},
            { "kanji": "æ˜Ž", "kana": "ãƒ¡ã‚¤ | ã‚ã‹(ã‚‹ã„)", "english": "bright, clear", "examples": [
                { "japanese": "æ˜Žã‚‹ã„ (ã‚ã‹ã‚‹ã„)", "english": "bright" },
                { "japanese": "æ˜Žæ—¥ (ã‚ã—ãŸ)", "english": "tomorrow" }
            ]},
            { "kanji": "æ–°", "kana": "ã‚·ãƒ³ | ã‚ãŸã‚‰(ã—ã„)", "english": "new", "examples": [
                { "japanese": "æ–°ã—ã„ (ã‚ãŸã‚‰ã—ã„)", "english": "new" },
                { "japanese": "æ–°èž (ã—ã‚“ã¶ã‚“)", "english": "newspaper" }
            ]},
            { "kanji": "å¤", "kana": "ã‚³ | ãµã‚‹(ã„)", "english": "old", "examples": [
                { "japanese": "å¤ã„ (ãµã‚‹ã„)", "english": "old" },
                { "japanese": "ä¸­å¤ (ã¡ã‚…ã†ã“)", "english": "used (item)" }
            ]},
            { "kanji": "å¤š", "kana": "ã‚¿ | ãŠãŠ(ã„)", "english": "many, much", "examples": [
                { "japanese": "å¤šã„ (ãŠãŠã„)", "english": "many" },
                { "japanese": "å¤šæ•° (ãŸã™ã†)", "english": "large number" }
            ]},
            { "kanji": "å°‘", "kana": "ã‚·ãƒ§ã‚¦ | ã™ã(ãªã„)", "english": "few, little", "examples": [
                { "japanese": "å°‘ãªã„ (ã™ããªã„)", "english": "few" },
                { "japanese": "å°‘ã— (ã™ã“ã—)", "english": "a little" }
            ]},
            { "kanji": "è¨€", "kana": "ã‚²ãƒ³ | ã„(ã†)", "english": "say, word", "examples": [
                { "japanese": "è¨€ã† (ã„ã†)", "english": "to say" },
                { "japanese": "è¨€è‘‰ (ã“ã¨ã°)", "english": "word" }
            ]},
            { "kanji": "è¡Œ", "kana": "ã‚³ã‚¦ | ã„(ã)", "english": "go, conduct", "examples": [
                { "japanese": "è¡Œã (ã„ã)", "english": "to go" },
                { "japanese": "æ—…è¡Œ (ã‚Šã‚‡ã“ã†)", "english": "travel" }
            ]},
            { "kanji": "æ¯Ž", "kana": "ãƒžã‚¤", "english": "every", "examples": [
                { "japanese": "æ¯Žæ—¥ (ã¾ã„ã«ã¡)", "english": "every day" },
                { "japanese": "æ¯Žé€± (ã¾ã„ã—ã‚…ã†)", "english": "every week" }
            ]},
            { "kanji": "ç™½", "kana": "ãƒã‚¯ | ã—ã‚(ã„)", "english": "white", "examples": [
                { "japanese": "ç™½ã„ (ã—ã‚ã„)", "english": "white" },
                { "japanese": "ç™½é»’ (ã—ã‚ãã‚)", "english": "black and white" }
            ]},
            { "kanji": "å£", "kana": "ã‚³ã‚¦ | ãã¡", "english": "mouth", "examples": [
                { "japanese": "å£ (ãã¡)", "english": "mouth" },
                { "japanese": "å…¥å£ (ã„ã‚Šãã¡)", "english": "entrance" }
            ]},
            { "kanji": "æ‰‹", "kana": "ã‚·ãƒ¥ | ã¦", "english": "hand", "examples": [
                { "japanese": "æ‰‹ (ã¦)", "english": "hand" },
                { "japanese": "ä¸Šæ‰‹ (ã˜ã‚‡ã†ãš)", "english": "skillful" }
            ]},
            { "kanji": "è¶³", "kana": "ã‚½ã‚¯ | ã‚ã—", "english": "foot, leg", "examples": [
                { "japanese": "è¶³ (ã‚ã—)", "english": "foot, leg" },
                { "japanese": "è¶³ã‚Šã‚‹ (ãŸã‚Šã‚‹)", "english": "to be sufficient" }
            ]},
            { "kanji": "è€³", "kana": "ã‚¸ | ã¿ã¿", "english": "ear", "examples": [
                { "japanese": "è€³ (ã¿ã¿)", "english": "ear" },
                { "japanese": "è€³é¼»ç§‘ (ã˜ã³ã‹)", "english": "otolaryngology" }
            ]},
            { "kanji": "ç›®", "kana": "ãƒ¢ã‚¯ | ã‚", "english": "eye", "examples": [
                { "japanese": "ç›® (ã‚)", "english": "eye" },
                { "japanese": "ç›®çš„ (ã‚‚ãã¦ã)", "english": "purpose" }
            ]},
            { "kanji": "ä½“", "kana": "ã‚¿ã‚¤ | ã‹ã‚‰ã ", "english": "body", "examples": [
                { "japanese": "ä½“ (ã‹ã‚‰ã )", "english": "body" },
                { "japanese": "ä½“è‚² (ãŸã„ã„ã)", "english": "physical education" }
            ]},
            { "kanji": "åŠ", "kana": "ãƒãƒ³", "english": "half", "examples": [
                { "japanese": "åŠåˆ† (ã¯ã‚“ã¶ã‚“)", "english": "half" },
                { "japanese": "åŠé¡ (ã¯ã‚“ãŒã)", "english": "half price" }
            ]},
            { "kanji": "æ™‚", "kana": "ã‚¸ | ã¨ã", "english": "time, hour", "examples": [
                { "japanese": "æ™‚é–“ (ã˜ã‹ã‚“)", "english": "time" },
                { "japanese": "æ™‚è¨ˆ (ã¨ã‘ã„)", "english": "watch, clock" }
            ]},
            { "kanji": "é–“", "kana": "ã‚«ãƒ³ | ã‚ã„ã ", "english": "interval, space", "examples": [
                { "japanese": "æ™‚é–“ (ã˜ã‹ã‚“)", "english": "time" },
                { "japanese": "é–“ã‚‚ãªã (ã¾ã‚‚ãªã)", "english": "soon" }
            ]},
            { "kanji": "ç•ª", "kana": "ãƒãƒ³", "english": "number, order", "examples": [
                { "japanese": "ä¸€ç•ª (ã„ã¡ã°ã‚“)", "english": "number one, best" },
                { "japanese": "ç•ªå· (ã°ã‚“ã”ã†)", "english": "number" }
            ]},
            { "kanji": "è²·", "kana": "ãƒã‚¤ | ã‹(ã†)", "english": "buy", "examples": [
                { "japanese": "è²·ã† (ã‹ã†)", "english": "to buy" },
                { "japanese": "è²·ã„ç‰© (ã‹ã„ã‚‚ã®)", "english": "shopping" }
            ]},
            { "kanji": "é•·", "kana": "ãƒãƒ§ã‚¦ | ãªãŒ(ã„)", "english": "long, leader", "examples": [
                { "japanese": "ç¤¾é•· (ã—ã‚ƒã¡ã‚‡ã†)", "english": "company president" },
                { "japanese": "é•·ã„ (ãªãŒã„)", "english": "long" }
            ]}
        ];

        let correctCount = 0;
        let incorrectCount = 0;
        let kanjiSession = []; // The active session's kanji
        let currentKanji = null;
        let isWaitingForNext = false;
        let selectedAnswerType = 'kana';
        let sessionKanjiLimit = 10; // Default session size

        const kanjiCard = document.getElementById('kanjiCard');
        const displayRadios = document.querySelectorAll('input[name="displayType"]');
        const optionsGrid = document.getElementById('optionsGrid');
        const answerTypeRadios = document.querySelectorAll('input[name="answerType"]');
        const displayTypeRadioGroup = document.getElementById('displayTypeRadioGroup');
        const answerTypeRadioGroup = document.getElementById('answerTypeRadioGroup');
        const optionsSection = document.getElementById('optionsSection');
        const sessionSizeSelect = document.getElementById('sessionSizeSelect');

        const kanaAnswerOptionDiv = document.getElementById('kanaAnswerOption');
        const englishAnswerOptionDiv = document.getElementById('englishAnswerOption');
        const kanjiAnswerOptionDiv = document.getElementById('kanjiAnswerOption');
        const kanaAnswerRadio = document.getElementById('kanaAnswer');
        const englishAnswerRadio = document.getElementById('englishAnswer');
        const kanjiAnswerRadio = document.getElementById('kanjiAnswer');


        const correctCountSpan = document.getElementById('correctCount');
        const incorrectCountSpan = document.getElementById('incorrectCount');
        const remainingCountSpan = document.getElementById('remainingCount');
        const percentageSpan = document.getElementById('percentage');

        // Function to shuffle an array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Function to update score display
        function updateScore() {
            correctCountSpan.textContent = correctCount;
            incorrectCountSpan.textContent = incorrectCount;
            remainingCountSpan.textContent = kanjiSession.length;
            const totalAttempted = correctCount + incorrectCount;
            if (totalAttempted > 0) {
                percentageSpan.textContent = ((correctCount / totalAttempted) * 100).toFixed(0);
            } else {
                percentageSpan.textContent = 0;
            }
        }

        // Function to get random incorrect options from the current *session's* Kanji pool
        function getRandomIncorrectOptions(correctKanji, numOptions = 8) {
            const incorrectOptions = kanjiN5Part1Full.filter(k => k.kanji !== correctKanji.kanji);
            shuffleArray(incorrectOptions);
            // Ensure we don't try to get more options than available
            return incorrectOptions.slice(0, Math.min(numOptions, incorrectOptions.length));
        }

        // Function to render the answer option buttons
        function renderAnswerOptions(allOptions) {
            optionsGrid.innerHTML = ''; // Clear previous options

            const answerType = document.querySelector('input[name="answerType"]:checked').value;

            allOptions.forEach(option => {
                const button = document.createElement('div');
                button.classList.add('option-button');

                if (answerType === 'kana') {
                    let optionKanaHtml = '';
                    const optionKanaReadings = option.kana.split(' | ');
                    if (optionKanaReadings.length === 2) {
                        optionKanaHtml = `<div class="onyomi-option-info">${optionKanaReadings[0]}</div><div class="kunyomi-option-info">${optionKanaReadings[1]}</div>`;
                    } else {
                        optionKanaHtml = `<div class="onyomi-option-info">${option.kana}</div>`;
                    }
                    button.innerHTML = optionKanaHtml;
                } else if (answerType === 'english') {
                    const englishDiv = document.createElement('div');
                    englishDiv.classList.add('english-option-info'); // Add a class for potential styling
                    englishDiv.textContent = option.english;
                    button.appendChild(englishDiv);
                } else if (answerType === 'kanji') { // New case for Kanji answer option
                    const kanjiDiv = document.createElement('div');
                    kanjiDiv.classList.add('kanji-option-info'); // Add a class for potential styling
                    kanjiDiv.textContent = option.kanji;
                    button.appendChild(kanjiDiv);
                }

                button.dataset.kanji = option.kanji; // Store the original Kanji for checking

                button.addEventListener('click', (event) => {
                    if (!isWaitingForNext) {
                        handleAnswer(event.currentTarget, event.currentTarget.dataset.kanji === currentKanji.kanji);
                    }
                });
                optionsGrid.appendChild(button);
            });
        }


        // Function to load a new Kanji
        function loadNewKanji() {
            // Reset state for new card
            isWaitingForNext = false;
            kanjiCard.classList.remove('reveal-state', 'correct-flash', 'incorrect-flash', 'initial-kana-view');
            kanjiCard.style.cursor = 'default';

            // Re-enable option buttons and remove previous styling
            Array.from(optionsGrid.children).forEach(button => {
                button.classList.remove('disabled-option', 'correct-answer', 'incorrect-answer');
                button.style.pointerEvents = 'auto';
            });

            // Show radio button groups and remove test-finished class
            displayTypeRadioGroup.style.display = 'flex';
            answerTypeRadioGroup.style.display = 'flex';
            optionsSection.classList.remove('test-finished');


            if (kanjiSession.length === 0) {
                kanjiCard.innerHTML = '<div class="text-6xl font-bold">ãŠç–²ã‚Œ!</div>';
                kanjiCard.classList.remove('reveal-state', 'correct-flash', 'incorrect-flash', 'initial-kana-view');
                kanjiCard.style.cursor = 'default';

                optionsGrid.innerHTML = ''; // Remove options

                // Hide radio button groups
                displayTypeRadioGroup.style.display = 'none';
                answerTypeRadioGroup.style.display = 'none';

                // Add test-finished class to options-section for centering
                optionsSection.classList.add('test-finished');

                // Calculate final percentage
                const finalTotalAttempted = correctCount + incorrectCount;
                const finalPercentage = finalTotalAttempted > 0 ? ((correctCount / finalTotalAttempted) * 100).toFixed(0) : 0;

                // Create and append the percentage display
                const percentageDisplay = document.createElement('div');
                percentageDisplay.classList.add('text-2xl', 'font-semibold', 'text-gray-800', 'mb-4');
                percentageDisplay.textContent = `Score: ${finalPercentage}%`;
                optionsSection.appendChild(percentageDisplay);


                // Create and append the restart button
                const restartButton = document.createElement('button');
                restartButton.textContent = 'Restart Practice';
                restartButton.classList.add('mt-4', 'px-6', 'py-3', 'bg-indigo-600', 'text-white', 'font-semibold', 'rounded-lg', 'shadow-md', 'hover:bg-indigo-700', 'focus:outline-none', 'focus:ring-2', 'focus:ring-indigo-500', 'focus:ring-offset-2', 'transition', 'ease-in-out', 'duration-150');
                restartButton.addEventListener('click', restartFlashcard);

                optionsSection.appendChild(restartButton);

                return;
            }

            // Get a random Kanji from the remaining ones
            const randomIndex = Math.floor(Math.random() * kanjiSession.length);
            currentKanji = kanjiSession[randomIndex];

            // Display the Kanji based on selected type and update answer options visibility
            updateKanjiDisplay();

            // Prepare options based on the *currently selected* answer type
            const correctOption = currentKanji;
            const incorrectOptions = getRandomIncorrectOptions(currentKanji, 8);
            let allOptions = [correctOption, ...incorrectOptions];
            shuffleArray(allOptions);

            renderAnswerOptions(allOptions); // Render options with the new logic
            updateScore();
        }

        // Function to update the main Kanji display
        function updateKanjiDisplay() {
            if (!currentKanji) return;
            const selectedDisplayType = document.querySelector('input[name="displayType"]:checked').value;
            let mainKanjiContent = '';

            kanjiCard.classList.remove('initial-kana-view');

            // --- Manage visibility of answer type options based on display type ---
            // Reset visibility
            kanaAnswerOptionDiv.style.display = 'none';
            englishAnswerOptionDiv.style.display = 'none';
            kanjiAnswerOptionDiv.style.display = 'none';

            // Determine which answer options are valid for the current display type
            let validAnswerTypes = [];
            if (selectedDisplayType === 'kana') {
                validAnswerTypes = ['english', 'kanji'];
            } else if (selectedDisplayType === 'english') {
                validAnswerTypes = ['kana', 'kanji'];
            } else { // selectedDisplayType === 'kanji'
                validAnswerTypes = ['kana', 'english'];
            }

            // Set the checked state for the answer type radios
            // If the previously selected answer type is still valid, keep it checked.
            // Otherwise, default to the first valid option.
            let newCheckedAnswerType = '';
            if (validAnswerTypes.includes(selectedAnswerType)) {
                newCheckedAnswerType = selectedAnswerType;
            } else {
                newCheckedAnswerType = validAnswerTypes[0];
            }

            // Set checked state and display for answer type radios
            if (newCheckedAnswerType === 'kana') {
                kanaAnswerRadio.checked = true;
                kanaAnswerOptionDiv.style.display = 'flex';
            } else if (newCheckedAnswerType === 'english') {
                englishAnswerRadio.checked = true;
                englishAnswerOptionDiv.style.display = 'flex';
            } else if (newCheckedAnswerType === 'kanji') {
                kanjiAnswerRadio.checked = true;
                kanjiAnswerOptionDiv.style.display = 'flex';
            }

            // Also ensure the other valid option is displayed (if not already checked)
            validAnswerTypes.forEach(type => {
                if (type !== newCheckedAnswerType) {
                    if (type === 'kana') kanaAnswerOptionDiv.style.display = 'flex';
                    if (type === 'english') englishAnswerOptionDiv.style.display = 'flex';
                    if (type === 'kanji') kanjiAnswerOptionDiv.style.display = 'flex';
                }
            });

            // Update the global selectedAnswerType to reflect the one now checked
            selectedAnswerType = newCheckedAnswerType;

            // --- Update main Kanji card content ---
            if (selectedDisplayType === 'kana') {
                let kanaDisplayHtml = '';
                const kanaReadings = currentKanji.kana.split(' | ');
                if (kanaReadings.length === 2) {
                    kanaDisplayHtml = `<div class="onyomi-info">${kanaReadings[0]}</div><div class="kunyomi-info">${kanaReadings[1]}</div>`;
                } else {
                    kanaDisplayHtml = `<div class="kana-info">${currentKanji.kana}</div>`;
                }
                mainKanjiContent = kanaDisplayHtml;
                kanjiCard.classList.add('initial-kana-view');
            } else if (selectedDisplayType === 'english') {
                mainKanjiContent = `<div class="text-9xl font-bold">${currentKanji[selectedDisplayType]}</div>`;
            } else { // selectedDisplayType === 'kanji'
                mainKanjiContent = `<div class="text-9xl font-bold">${currentKanji[selectedDisplayType]}</div>`;
            }

            kanjiCard.innerHTML = `
                <div class="text-center">
                    ${mainKanjiContent}
                </div>
            `;

            // Re-render options based on the newly selected answer type
            const correctOption = currentKanji;
            const incorrectOptions = getRandomIncorrectOptions(currentKanji, 8);
            let allOptions = [correctOption, ...incorrectOptions];
            shuffleArray(allOptions);
            renderAnswerOptions(allOptions);
        }

        // Handle answer selection
        function handleAnswer(clickedButton, isCorrect) {
            isWaitingForNext = true;
            kanjiCard.classList.add('reveal-state');
            kanjiCard.style.cursor = 'pointer';

            if (isCorrect) {
                kanjiCard.classList.add('correct-flash');
                kanjiCard.classList.remove('incorrect-flash');
                kanjiSession = kanjiSession.filter(k => k.kanji !== currentKanji.kanji);
                correctCount++;
            } else {
                kanjiCard.classList.add('incorrect-flash');
                kanjiCard.classList.remove('correct-flash');
                incorrectCount++;
            }

            let kanaDisplayHtml = '';
            const kanaReadings = currentKanji.kana.split(' | ');
            if (kanaReadings.length === 2) {
                kanaDisplayHtml = `<div class="onyomi-info">${kanaReadings[0]}</div><div class="kunyomi-info">${kanaReadings[1]}</div>`;
            } else {
                kanaDisplayHtml = `<div class="kana-info">${currentKanji.kana}</div>`;
            }

            let examplesHtml = '';
            if (currentKanji.examples && currentKanji.examples.length > 0) {
                examplesHtml = `<div class="example-words">`;
                currentKanji.examples.forEach(example => {
                    examplesHtml += `<div><span>${example.japanese}</span><span>${example.english}</span></div>`;
                });
                examplesHtml += `</div>`;
            }

            kanjiCard.innerHTML = `
                <div class="main-kanji-char">${currentKanji.kanji}</div>
                <div class="english-info">${currentKanji.english}</div>
                <div class="kana-info-group">${kanaDisplayHtml}</div>
                ${examplesHtml}
                <div class="next-card-message">Press any key or swipe anywhere for next card</div>
            `;

            // Add event listener to the new close button
            kanjiCard.querySelector('.close-button').addEventListener('click', (event) => {
                event.stopPropagation(); // Prevent card advance when clicking close
                loadNewKanji(); // Load next card directly
            });

            Array.from(optionsGrid.children).forEach(button => {
                button.classList.add('disabled-option');
                button.style.pointerEvents = 'none';

                if (button.dataset.kanji === currentKanji.kanji) {
                    button.classList.add('correct-answer');
                } else if (button === clickedButton && !isCorrect) {
                    button.classList.add('incorrect-answer');
                }
            });

            updateScore();
        }

        // Handler for clicking the main Kanji card to advance
        function advanceKanjiHandler() {
            if (isWaitingForNext) {
                loadNewKanji();
            }
        }

        // Global handler for advancing to the next Kanji
        function globalAdvanceHandler(event) {
            // Check if the event target is NOT the close button or any of the option buttons
            const targetIsCloseButton = event.target.closest('.close-button');
            const targetIsOptionButton = event.target.closest('.option-button');

            if (isWaitingForNext && (event.type === 'keydown' || (event.type === 'click' && event.button === 0 && !targetIsCloseButton && !targetIsOptionButton))) {
                loadNewKanji();
            }
        }

        // Function to restart the flashcard session
        function restartFlashcard() {
            correctCount = 0;
            incorrectCount = 0;
            const shuffledKanji = shuffleArray([...kanjiN5Part1Full]);
            // Take a slice of the shuffled array based on the limit
            if (sessionSizeSelect.value === 'all') {
                kanjiSession = shuffledKanji;
            } else {
                kanjiSession = shuffledKanji.slice(0, parseInt(sessionSizeSelect.value));
            }
            // Reset the remaining count display immediately
            remainingCountSpan.textContent = kanjiSession.length;


            const restartButton = optionsSection.querySelector('button');
            const percentageDisplay = optionsSection.querySelector('.text-2xl.font-semibold');
            if (restartButton) {
                restartButton.remove();
            }
            if (percentageDisplay) {
                percentageDisplay.remove();
            }

            loadNewKanji();
        }

        // Event listeners for display type radios
        displayRadios.forEach(radio => {
            radio.addEventListener('change', updateKanjiDisplay);
        });

        // Event listeners for answer type radios (reloads options with new type)
        answerTypeRadios.forEach(radio => {
            radio.addEventListener('change', (event) => {
                selectedAnswerType = event.target.value; // Store the newly selected answer type
                const correctOption = currentKanji;
                const incorrectOptions = getRandomIncorrectOptions(currentKanji, 8);
                let allOptions = [correctOption, ...incorrectOptions];
                shuffleArray(allOptions);
                renderAnswerOptions(allOptions);
            });
        });

        // Event listener for the new session size select menu
        sessionSizeSelect.addEventListener('change', () => {
            restartFlashcard();
        });


        // Add click listener to the kanjiCard to advance (restored)
        kanjiCard.addEventListener('click', advanceKanjiHandler);

        // Add global event listeners for keyboard and mouse clicks (retained)
        document.addEventListener('keydown', globalAdvanceHandler);
        document.addEventListener('click', globalAdvanceHandler);

        // Initial load
        window.onload = () => {
            restartFlashcard();
        };
    </script>
</body>
</html>
